<!doctype html>
<html lang="en" class="no-js">
    <head>  
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Add a title to the page -->
        <title>Translators of the Ancient Mediterranean</title>
        <!-- link to Montserrat font -->
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <!-- link to Orpheus Pro Bold font -->
        <link href="https://db.onlinewebfonts.com/c/81651a191b7129993b0871c834a19600?family=OrpheusPro-Bold" rel="stylesheet">
        <!-- link to Poppins font -->
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">   
        <!-- leaflet css -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
        <!-- for the collapsible sidebar -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
        <link rel="stylesheet" href="src/leaflet-sidebar.css" />            
        <!-- custom style here -->
        <style type="text/css">
            /* Set the page and body parameters */
            body,
            html {
            margin: 0;
            padding: 0;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
            }
            /* Set map parameters */
            #map {
            position: fixed;
            bottom: 0px;
            width: 100%;
            top: 0px;
            } 
            /* Font styles */
            h1 {
                color: white;
                font-size: 16px;
                display: inline-block;
                margin-top: 0.5em;
                margin-bottom: 0.0em;
                margin-left: 0.8em;
                margin-right: 0;
                font-weight: normal;
                font-family: "Montserrat";
            }
            h2 {
                font-size: 12px;
                color: white;
                display: inline-block;
                margin-top: 0.25em;
                margin-bottom: 0.0em;
                margin-left: 1.0em;
                margin-right: 0;
                font-weight: normal;
                font-family: "Montserrat";
            }
            h4 {
                font-size: 16px;
                margin: 4px;
            }            
            /* custom sidebar css */
                /* sidebar header */
                .sidebar-header {
                    width: 100%;
                    font-family: "OrpheusPro-Bold"; 
                }
                /* sidebar icon */
                i {
                    color: rgb(0, 0, 0);
                }
                /* sidebar about heading */
                .about {
                    color: rgb(0, 0, 0);
                    font-family: "OrpheusPro-Bold"; 
                    font-size: 16px;
                    margin-bottom: 0px;
                    margin-top: 0px;
                    margin-left: 0px;
                }
                /* selection heading */
                .choose {
                    color: rgb(0, 0, 0);
                    font-family: "OrpheusPro-Bold"; 
                    font-size: 16px;
                    margin-bottom: 0px;
                    margin-top: 0px;
                    margin-left: 0px;       
                }
                /* map info */
                .details {
                    font-family: 'Poppins', sans-serif;
                    font-size: 13px;
                    font-weight: normal;
                    margin-bottom: 0px;
                    margin-top: 0px;
                }
                .instructions {
                    font-family: 'Poppins', sans-serif;
                    font-size: 12px;
                    font-weight: normal;
                    margin-bottom: 0px;
                    margin-top: 0px;        
                }
                .introbreak {
                    display: block;
                    margin-bottom: 1em;
                }       
                /* collapsible div css */
                .header {
                    display: flex;
                    align-items: center;
                }
                #collapseButton {
                    background: none;
                    border: none;
                    cursor: pointer;
                    font-size: 1rem;
                    color: #333;
                    margin-right: 10px; /* Add some spacing between the button and the h2 element */
                }
                #collapseButton .icon {
                    margin-right: 5px;
                }
            /* End custom sidebar css */        
        </style>
    </head>
    <body>
        <div id="sidebar" class="sidebar collapsed">    
            <div class="sidebar-tabs">
                <ul role="tablist">
                  <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                </ul>
            </div> 
            <div class="sidebar-content">
                <div class="sidebar-pane" id="home">
                    <h1 class="sidebar-header">Translators of the Ancient Mediterranean<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1><br>
                    <br>
                    <div class="header">
                        <button id="collapseButton"><span class="icon"><i class="fas fa-chevron-up"></i></span></button>
                        <h2 class="about">About This Project</h2>
                    </div>
                    <div id="collapsibleContent">
                        </b><br>
                        <h3 class="details">Explain the map here.</h3>
                        <br><h4 class="instructions">1.) Provide instructions for the map here.</h4>
                        <br><h3 class="details">Give credits here.</h3>
                        <p style="padding-bottom:0px"></p>
                    </div>
                    <div id="dropdown-instructions">
                        <p><h2 class="choose">Filter by interest:</h2></p>
                    </div>
                    <form id="map_parameters" name="map_parameters" action="#" accept-charset="utf-8" class="inlineForm">
                        <select id="interest-select" class="div-toggle" data-target=".my-info-1">
                            <option value="0">No interest selected</option>
                        </select>
                    </form>
                    <div id="dropdown-instructions">
                        <p><h2 class="choose">Filter by focus:</h2></p>
                    </div>
                    <form id="map_parameters" name="map_parameters" action="#" accept-charset="utf-8" class="inlineForm">
                        <select id="focus-select" class="div-toggle" data-target=".my-info-1">
                            <option value="0">No focus selected</option>
                        </select>
                    </form>
                    <div id="dropdown-instructions">
                        <p><h2 class="choose">Filter by name:</h2></p>
                    </div>
                    <form id="map_parameters" name="map_parameters" action="#" accept-charset="utf-8" class="inlineForm">
                        <select id="name-select" class="div-toggle" data-target=".my-info-1">
                            <option value="0">No translator selected</option>
                        </select>
                    </form>                    
                    <!-- Add a button to trigger the handleButtonClick() function -->
                    <div id="search-instructions">
                    <p><h2 class="choose">Reset or zoom out.</h2></p>
                    </div>
                        <!-- Wrap the buttons in a container div to control their layout -->
                        <div class="button-container">
                            <button onclick="handleButtonClick()">Reset</button>
                            <button onclick="handleZoomOutClick()">Zoom Out</button>
                        </div>                      
                    </div>
                    <br>
                    <div id="sidebar-info" class="my-info-1">
                        <div id="content-info" class="contentinfo hide"></div>
                    </div>                
                </div>
            </div>                       
        </div>
        <!-- map -->
        <div id="map"></div>
        <!-- leaflet js -->
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
        <!-- d3js -->
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <!-- chroma -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.2.1/chroma.min.js"></script>
        <!-- sidebar -->
        <script src="src/svg-icon.js"></script>
        <script src="src/leaflet-sidebar.js"></script>
        <!-- javascript below -->            
        <script>
            // Initialize the map
            const map = L.map('map');
            // add a basemap
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 20
            }).addTo(map);
            // Add a scale bar
                L.control.scale({
                position: 'bottomright'
            }).addTo(map);
            // Remove the default zoom control
            map.zoomControl.remove();            
            // Add a sidebar to the map
            const sidebar = L.control.sidebar("sidebar").addTo(map);
            sidebar.open("home");
            // Code to collapse about content
            const collapseButton = document.getElementById('collapseButton'); // Define the collapse button
            const collapsibleContent = document.getElementById('collapsibleContent'); // Define the collapsible content
            // Add a click event listener to the button
            collapseButton.addEventListener('click', function() {
                // Check if the collapsible content is already open
                if (collapsibleContent.style.display === 'none') {
                    // Show the collapsible content
                    collapsibleContent.style.display = 'block';
                    // Change the button icon
                    collapseButton.innerHTML = '<span class="icon"><i class="fas fa-chevron-up"></i></span>';
                } else {
                    // Hide the collapsible content
                    collapsibleContent.style.display = 'none';
                    // Change the button icon
                    collapseButton.innerHTML = '<span class="icon"><i class="fas fa-chevron-down"></i></span>';
                }
            });
            // Define an empty array to hold the chapter content
            let chapterContent = [];
            // Define an empty array to hold the translator names
            let names = [];
            // Define an empty array to hold the translator interests
            let interests = [];
            // Define an empty array to hold the filtered interests
            let filteredInterests = [];
            // Define an empty array to hold the translator focuses
            let focuses = [];
            // Define an empty array to hold the filtered focuses
            let filteredFocuses = [];
            // Declare a global variable to hold the translator locations layer
            let translocLayer;
            // Define an empty layer to hold the selected translators
            const selectedTranslators = L.layerGroup().addTo(map);            
            // define sidebar info
            const info = document.getElementById('content-info');
            // Define the name dropdown menu
            const nameSelect = document.getElementById('name-select');
            // Define the interest dropdown menu
            const interestSelect = document.getElementById('interest-select');   
            // Define the focus dropdown menu
            const focusSelect = document.getElementById('focus-select');         
            // Load the data asynchronously
            d3.queue()
                .defer(d3.json, "data/translators-found.geojson") // Load the translators-found data
                .await(drawMap); // Call the drawMap function when the data is loaded
            // Define the drawMap function
            function drawMap(err, translocs) {
                
                const translatorLocs = L.geoJson(translocs, {
                    pointToLayer: function (feature, latlng) {
                        // Create a blue marker
                        return L.marker(latlng, {
                            icon: L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                shadowSize: [41, 41]
                            })
                        });
                    },
                    onEachFeature: function (feature, layer) {
                        // Push the translator name to the names array
                        names.push(feature.properties.Author);
                        // If there is a comma in the interest field, split it into an array
                        if (feature.properties.AOI.includes(',')) {
                            const splitInterests = feature.properties.AOI.split(',');
                            // Loop through the split interests array
                            for (let i = 0; i < splitInterests.length; i++) {
                                // if there is a space at the beginning of the interest, remove the space
                                if (splitInterests[i].charAt(0) === ' ') {
                                    splitInterests[i] = splitInterests[i].substring(1);
                                }
                                // if there is an "and" at the beginning of the interest, remove "and"
                                if (splitInterests[i].substring(0, 3) === 'and') {
                                    splitInterests[i] = splitInterests[i].substring(4);
                                }
                                // Push the split interest to the interests array
                                interests.push(splitInterests[i]);
                            }
                        } else {
                            // Push the interest to the interests array
                            interests.push(feature.properties.AOI);
                        };
                        // If there is a comma in the focus field, split it into an array
                        if (feature.properties.Focus.includes(',')) {
                            const splitFocuses = feature.properties.Focus.split(',');
                            // Loop through the split focuses array
                            for (let i = 0; i < splitFocuses.length; i++) {
                                // if there is a space at the beginning of the focus, remove the space
                                if (splitFocuses[i].charAt(0) === ' ') {
                                    splitFocuses[i] = splitFocuses[i].substring(1);
                                }
                                // if there is an "and" at the beginning of the focus, remove "and"
                                if (splitFocuses[i].substring(0, 3) === 'and') {
                                    splitFocuses[i] = splitFocuses[i].substring(4);
                                }
                                // if an entry is '' remove it
                                if (splitFocuses[i] === '') {
                                    splitFocuses.splice(i, 1);
                                }
                                // Push the split focus to the focuses array
                                focuses.push(splitFocuses[i]);
                            }
                        } else {
                            // Push the focus to the focuses array
                            focuses.push(feature.properties.Focus);
                        };
                        // Add a tooltip to each marker to display the translators' names
                        layer.bindTooltip('<div style="max-width: 250px; width: max-content; white-space: normal;"><b>' + feature.properties.Author + '</b><hr>' + feature.properties.Affiliation + '<br>' + feature.properties.Position + '<br><b>Interest:</b> ' + feature.properties.AOI + '<br><b>Focus:</b> ' + feature.properties.Focus);
                        // On mouseover, change the marker color
                        layer.on('mouseover', function(e) {
                            // Change the marker color
                            this.setIcon(L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                shadowSize: [41, 41]
                            }));
                        });
                        // On mouseout, change the marker color back
                        layer.on('mouseout', function(e) {
                            // Change the marker color
                            this.setIcon(L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                shadowSize: [41, 41]
                            }));
                        });
                    },
                });            
                // Assign the translatorLocs layer to the global translocLayer variable
                translocLayer = translatorLocs;
                // Add the translocLayer to the map
                translocLayer.addTo(map);
                // Fit the map to the translatorLocs bounds
                map.fitBounds(translatorLocs.getBounds());
                // Reorder the names array alphabetically
                names.sort();
                // Reorder the interests array alphabetically
                interests.sort();
                // Remove duplicate interests from the interests array
                interests = interests.filter(function(item, index) {
                    return interests.indexOf(item) >= index;
                });
                // Reorder the focuses array alphabetically
                focuses.sort();
                // Remove duplicate focuses from the focuses array
                focuses = focuses.filter(function(item, index) {
                    return focuses.indexOf(item) >= index;
                });
                // Add the names array to the dropdown menu
                for (let i = 0; i < names.length; i++) {
                    const opt = names[i];
                    const el = document.createElement("option");
                    el.textContent = opt;
                    el.value = opt;
                    nameSelect.appendChild(el);
                };
                // Add the interests array to the dropdown menu
                for (let i = 0; i < interests.length; i++) {
                    const opt = interests[i];
                    const el = document.createElement("option");
                    el.textContent = opt;
                    el.value = opt;
                    interestSelect.appendChild(el);
                };
                // Add the focuses array to the dropdown menu
                for (let i = 0; i < focuses.length; i++) {
                    const opt = focuses[i];
                    const el = document.createElement("option");
                    el.textContent = opt;
                    el.value = opt;
                    focusSelect.appendChild(el);
                };              
                // If the user selects a focus
                focusSelect.addEventListener('change', function() {
                    // If a focus is selected, but nothing else...
                    if (interestSelect.value === "0" && focusSelect.value !== "0" && nameSelect.value === "0") {
                        // Remove the translocLayer
                        translocLayer.removeFrom(map);
                        // Clear the selectedTranslators layer
                        selectedTranslators.clearLayers();  
                        // Clear the chapterContent array
                        chapterContent.length = 0;
                        // Clear the name dropdown
                        nameSelect.innerHTML = '<option value="0">No translator selected</option>'; 
                        // Get the selected focus
                        const selectedFocus = focusSelect.value;
                        // Loop through the translocLayer features
                        translocLayer.eachLayer(function(layer){    
                            // If the selected focus is found in the layer...
                            if (layer.feature.properties.Focus.includes(selectedFocus)) {
                                // Define the author
                                const author = layer.feature.properties.Author;

                                // Add author to the name dropdown
                                const authorOption = document.createElement("option");
                                authorOption.textContent = author;
                                authorOption.value = author;
                                nameSelect.appendChild(authorOption);
                                
                                // Add the layer to the selectedTranslators layer
                                selectedTranslators.addLayer(layer);
                                // Build out the chapterContent array
                                chapterContent.push('<p style="margin-left: 1.4em"><b style="font-size: 12pt">' + layer.feature.properties.Author + '</b><br><br>' + layer.feature.properties.Affiliation + '<br>' + layer.feature.properties.Position + '<br><b>Interest:</b> ' + layer.feature.properties.AOI + '<br><b>Focus:</b> ' + layer.feature.properties.Focus + '</p>');
                                // Fit the map to the markers on the map
                                if (selectedTranslators.getLayers().length > 0) {
                                    // Initialize an empty LatLngBounds object
                                    let bounds = L.latLngBounds();
                                    // Loop through the selectedTranslators layer to get the bounds
                                    selectedTranslators.eachLayer(function(layer) {
                                        bounds.extend(layer.getLatLng());
                                    });
                                    // Fit the map to the bounds
                                    map.fitBounds(bounds);
                                };                                   
                            } else {
                                // Remove the layer from the selectedTranslators layer
                                selectedTranslators.removeLayer(layer);
                            };
                        });
                    };
                    // Set the maximum zoom level to 10 if the current zoom level is greater than 10
                    if (map.getZoom() > 10) {
                        map.setZoom(10);
                    };                    
                    // Join the chapterContent array, and set it as the innerHTML of the info div
                    info.innerHTML = chapterContent.join('<br>');                    
                });
                // If the user selects a translator
                nameSelect.addEventListener('change', function() {
                    // Remove the translocLayer
                    translocLayer.removeFrom(map);
                    // Clear the selectedTranslators layer
                    selectedTranslators.clearLayers();                    
                    // Clear the chapterContent array
                    chapterContent.length = 0;
                    // If name is selected, but nothing else...
                    if (interestSelect.value === "0" && focusSelect.value === "0" && nameSelect.value !== "0") {
                        // Get the selected name
                        const selectedName = nameSelect.value;
                        // Loop through the translocLayer features
                        translocLayer.eachLayer(function(layer) {
                            // If the selected name is found in the layer...
                            if (layer.feature.properties.Author === selectedName) {                                 
                                // Add the layer to the selectedTranslators layer
                                selectedTranslators.addLayer(layer);
                                // Open the tooltip on the layer
                                layer.openTooltip();
                                // Build out the chapterContent array
                                chapterContent.push('<p style="margin-left: 1.4em"><b style="font-size: 12pt">' + layer.feature.properties.Author + '</b><br><br>' + layer.feature.properties.Affiliation + '<br>' + layer.feature.properties.Position + '<br><b>Interest:</b> ' + layer.feature.properties.AOI + '<br><b>Focus:</b> ' + layer.feature.properties.Focus + '</p>');
                                // Fit the map to the markers on the map
                                if (selectedTranslators.getLayers().length > 0) {
                                    // Initialize an empty LatLngBounds object
                                    let bounds = L.latLngBounds();
                                    // Loop through the selectedTranslators layer to get the bounds
                                    selectedTranslators.eachLayer(function(layer) {
                                        bounds.extend(layer.getLatLng());
                                    });
                                    // Fit the map to the bounds
                                    map.fitBounds(bounds);
                                };                                
                            } else {
                                // Remove the layer from the selectedTranslators layer
                                selectedTranslators.removeLayer(layer);
                            };
                        });
                    };
                    // Set the maximum zoom level to 10 if the current zoom level is greater than 10
                    if (map.getZoom() > 10) {
                        map.setZoom(10);
                    };                    
                    // Join the chapterContent array, and set it as the innerHTML of the info div
                    info.innerHTML = chapterContent.join('<br>');
                });
                // if the user selects an interest
                interestSelect.addEventListener('change', function() {

/* THIS MAY NEED TO GO IN THE CONDITIONS BELOW */                    
                    // Remove the translocLayer
                    translocLayer.removeFrom(map);
                    // Clear the selectedTranslators layer
                    selectedTranslators.clearLayers();                    
                    // Clear the chapterContent array
                    chapterContent.length = 0;
                    // Clear the filtered interests array
                    filteredInterests.length = 0;
                    // Clear the filtered focuses array
                    filteredFocuses.length = 0;
                    // Clear the name dropdown
                    nameSelect.innerHTML = '<option value="0">No translator selected</option>';
                    // Clear the focus dropdown
                    focusSelect.innerHTML = '<option value="0">No focus selected</option>';


                    // If the interest dropdown is set to "0", return the name dropdown and the focus dropdown to their default states
                    if (interestSelect.value === "0") {
                        // Add the names array to the dropdown menu
                        for (let i = 0; i < names.length; i++) {
                            const opt = names[i];
                            const el = document.createElement("option");
                            el.textContent = opt;
                            el.value = opt;
                            nameSelect.appendChild(el);
                        };
                        // Add the focuses array to the dropdown menu
                        for (let i = 0; i < focuses.length; i++) {
                            const opt = focuses[i];
                            const el = document.createElement("option");
                            el.textContent = opt;
                            el.value = opt;
                            focusSelect.appendChild(el);
                        };
                    // If an interest is selected and nothing else is...
                    } if (interestSelect.value !== "0" && focusSelect.value === "0" && nameSelect.value === "0") {
                        // Get the selected interest
                        const selectedInterest = interestSelect.value;
                        // Loop through the translocLayer features
                        translocLayer.eachLayer(function(layer) {
                            // If the selected interest is found in the layer, add the author to the name dropdown
                            // and add the focus to the focus dropdown
                            if (layer.feature.properties.AOI.includes(selectedInterest)) {
                                const author = layer.feature.properties.Author;
                                const focus = layer.feature.properties.Focus;

                                // Add author to the name dropdown
                                const authorOption = document.createElement("option");
                                authorOption.textContent = author;
                                authorOption.value = author;
                                nameSelect.appendChild(authorOption);

                                // Add focus(es) to the filteredFocuses array
                                if (focus.includes(',')) {
                                    const splitFocuses = focus.split(',');
                                    splitFocuses.forEach(splitFocus => {
                                        addToFilteredFocuses(splitFocus.trim());
                                    });
                                } else {
                                    addToFilteredFocuses(focus);
                                };
                                // Add the layer to the selectedTranslators layer
                                selectedTranslators.addLayer(layer);
                                // Build out the chapterContent array
                                chapterContent.push('<p style="margin-left: 1.4em"><b style="font-size: 12pt">' + layer.feature.properties.Author + '</b><br><br>' + layer.feature.properties.Affiliation + '<br>' + layer.feature.properties.Position + '<br><b>Interest:</b> ' + layer.feature.properties.AOI + '<br><b>Focus:</b> ' + layer.feature.properties.Focus + '</p>');
                                // Fit the map to the markers on the map
                                if (selectedTranslators.getLayers().length > 0) {
                                    // Initialize an empty LatLngBounds object
                                    let bounds = L.latLngBounds();
                                    // Loop through the selectedTranslators layer to get the bounds
                                    selectedTranslators.eachLayer(function(layer) {
                                        bounds.extend(layer.getLatLng());
                                    });
                                    // Fit the map to the bounds
                                    map.fitBounds(bounds);
                                };                                
                            } else {
                                // Remove the layer from the selectedTranslators layer
                                selectedTranslators.removeLayer(layer);
                            };
                        });
                        // Call the updateUI() function
                        updateUI();                     
                    };
                    // If the user selects a focus...
                    focusSelect.addEventListener('change', function() { 
                        // Clear the selectedTranslators layer
                        selectedTranslators.clearLayers();
                        // Clear the chapterContent array
                        chapterContent.length = 0;
                        // Clear the name dropdown
                        nameSelect.innerHTML = '<option value="0">No translator selected</option>';
                        // If interest and focus are selected and nothing else is...
                        if (interestSelect.value !== "0" && focusSelect.value !== "0" && nameSelect.value === "0") {
                            // Get the selected interest
                            const selectedInterest = interestSelect.value;
                            // Get the selected focus
                            const selectedFocus = focusSelect.value;
                            // Loop through the translocLayer features
                            translocLayer.eachLayer(function(layer) {
                                // If the selected interest is found in the layer, add the author to the name dropdown
                                // and add the focus to the focus dropdown
                                if (layer.feature.properties.AOI.includes(selectedInterest) && layer.feature.properties.Focus.includes(selectedFocus)) {
                                    const author = layer.feature.properties.Author;
                                    const focus = layer.feature.properties.Focus;

                                    // Add author to the name dropdown
                                    const authorOption = document.createElement("option");
                                    authorOption.textContent = author;
                                    authorOption.value = author;
                                    nameSelect.appendChild(authorOption);

                                    // Add focus(es) to the filteredFocuses array
                                    if (focus.includes(',')) {
                                        const splitFocuses = focus.split(',');
                                        splitFocuses.forEach(splitFocus => {
                                            addToFilteredFocuses(splitFocus.trim());
                                        });
                                    } else {
                                        addToFilteredFocuses(focus);
                                    };
                                    // Add the layer to the selectedTranslators layer
                                    selectedTranslators.addLayer(layer);
                                    // Build out the chapterContent array
                                    chapterContent.push('<p style="margin-left: 1.4em"><b style="font-size: 12pt">' + layer.feature.properties.Author + '</b><br><br>' + layer.feature.properties.Affiliation + '<br>' + layer.feature.properties.Position + '<br><b>Interest:</b> ' + layer.feature.properties.AOI + '<br><b>Focus:</b> ' + layer.feature.properties.Focus + '</p>');
                                    // Fit the map to the markers on the map
                                    if (selectedTranslators.getLayers().length > 0) {
                                        // Initialize an empty LatLngBounds object
                                        let bounds = L.latLngBounds();
                                        // Loop through the selectedTranslators layer to get the bounds
                                        selectedTranslators.eachLayer(function(layer) {
                                            bounds.extend(layer.getLatLng());
                                        });
                                        // Fit the map to the bounds
                                        map.fitBounds(bounds);
                                    };                                
                                } else {
                                    // Remove the layer from the selectedTranslators layer
                                    selectedTranslators.removeLayer(layer);
                                };
                            });
                        };
                        // Call the updateUI() function
                        updateUI();
                    });
                    // If the user selects a translator...
                    nameSelect.addEventListener('change', function() {
                        // Clear the selectedTranslators layer
                        selectedTranslators.clearLayers();
                        // Clear the chapterContent array
                        chapterContent.length = 0;
                        // If interest, focus, and name are selected...
                        if (interestSelect.value !== "0" && focusSelect.value !== "0" && nameSelect.value !== "0") {
                            // Get the selected interest
                            const selectedInterest = interestSelect.value;
                            // Get the selected focus
                            const selectedFocus = focusSelect.value;
                            // Get the selected name
                            const selectedName = nameSelect.value;
                            // Loop through the translocLayer features
                            translocLayer.eachLayer(function(layer) {
                                // If the selected interest is found in the layer, add the author to the name dropdown
                                // and add the focus to the focus dropdown
                                if (layer.feature.properties.AOI.includes(selectedInterest) && layer.feature.properties.Focus.includes(selectedFocus) && layer.feature.properties.Author === selectedName) {
                                    // Add the layer to the selectedTranslators layer
                                    selectedTranslators.addLayer(layer);
                                    // Open the tooltip on the layer
                                    layer.openTooltip();                                    
                                    // Build out the chapterContent array
                                    chapterContent.push('<p style="margin-left: 1.4em"><b style="font-size: 12pt">' + layer.feature.properties.Author + '</b><br><br>' + layer.feature.properties.Affiliation + '<br>' + layer.feature.properties.Position + '<br><b>Interest:</b> ' + layer.feature.properties.AOI + '<br><b>Focus:</b> ' + layer.feature.properties.Focus + '</p>');
                                    // Fit the map to the markers on the map
                                    if (selectedTranslators.getLayers().length > 0) {
                                        // Initialize an empty LatLngBounds object
                                        let bounds = L.latLngBounds();
                                        // Loop through the selectedTranslators layer to get the bounds
                                        selectedTranslators.eachLayer(function(layer) {
                                            bounds.extend(layer.getLatLng());
                                        });
                                        // Fit the map to the bounds
                                        map.fitBounds(bounds);
                                    };                                
                                } else {
                                    // Remove the layer from the selectedTranslators layer
                                    selectedTranslators.removeLayer(layer);
                                };
                            });
                        };
                        // If interest and name are selected, but nothing else...
                        if (interestSelect.value !== "0" && focusSelect.value === "0" && nameSelect.value !== "0") {
                            // Get the selected interest
                            const selectedInterest = interestSelect.value;
                            // Get the selected name
                            const selectedName = nameSelect.value;
                            // Loop through the translocLayer features
                            translocLayer.eachLayer(function(layer) {
                                // If the selected interest is found in the layer, add the author to the name dropdown
                                // and add the focus to the focus dropdown
                                if (layer.feature.properties.AOI.includes(selectedInterest) && layer.feature.properties.Author === selectedName) {                                 
                                    // Add the layer to the selectedTranslators layer
                                    selectedTranslators.addLayer(layer);
                                    // Open the tooltip on the layer
                                    layer.openTooltip();                                    
                                    // Build out the chapterContent array
                                    chapterContent.push('<p style="margin-left: 1.4em"><b style="font-size: 12pt">' + layer.feature.properties.Author + '</b><br><br>' + layer.feature.properties.Affiliation + '<br>' + layer.feature.properties.Position + '<br><b>Interest:</b> ' + layer.feature.properties.AOI + '<br><b>Focus:</b> ' + layer.feature.properties.Focus + '</p>');
                                    // Fit the map to the markers on the map
                                    if (selectedTranslators.getLayers().length > 0) {
                                        // Initialize an empty LatLngBounds object
                                        let bounds = L.latLngBounds();
                                        // Loop through the selectedTranslators layer to get the bounds
                                        selectedTranslators.eachLayer(function(layer) {
                                            bounds.extend(layer.getLatLng());
                                        });
                                        // Fit the map to the bounds
                                        map.fitBounds(bounds);
                                    };                                
                                } else {
                                    // Remove the layer from the selectedTranslators layer
                                    selectedTranslators.removeLayer(layer);
                                };
                            });
                        };
                        // Call the updateUI() function
                        updateUI();
                    });
                });
            };
            function addToFilteredFocuses(focus) {
                if (focus && focus.trim() !== '') {
                    filteredFocuses.push(focus.trim());
                }
            };                  
            // Define the handleZoomOutClick() function
            function handleZoomOutClick() {
                // Perform the zoom-out operation using fitBounds()
                map.fitBounds(translocLayer.getBounds());
            };
            // Define the handleButtonClick() function
            function handleButtonClick() {
                // Refresh the page
                location.reload();         
            };
            function updateUI() {
                // Set the maximum zoom level to 10 if the current zoom level is greater than 10
                if (map.getZoom() > 10) {
                    map.setZoom(10);
                }

                // Remove duplicate focuses from the filteredFocuses array
                filteredFocuses = filteredFocuses.filter(function(item, index) {
                    return filteredFocuses.indexOf(item) >= index;
                });

                // Sort the filteredFocuses array alphabetically
                filteredFocuses.sort();

                // Add the filteredFocuses array to the dropdown menu
                for (let i = 0; i < filteredFocuses.length; i++) {
                    const opt = filteredFocuses[i];
                    const el = document.createElement("option");
                    el.textContent = opt;
                    el.value = opt;
                    focusSelect.appendChild(el);
                }

                // Join the chapterContent array, and set it as the innerHTML of the info div
                info.innerHTML = chapterContent.join('<br>');
            };

        </script>
    </body>
</html>